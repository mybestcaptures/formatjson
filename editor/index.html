<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JSON Editor & Tool</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Optional: Custom styles for JSON Editor (basic, can be customized) */
      #json-editor-container {
        border: 2px solid #e5e7eb;
        border-radius: 0.5rem;
        padding: 1rem;
        margin-bottom: 1rem;
        min-height: 200px;
        max-height: 500px;
        overflow-y: auto;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        font-size: 0.875rem;
        line-height: 1.5rem;
      }
      #json-editor-container:focus-within {
        box-shadow: 0 0 0 3px rgba(164, 202, 254, 0.5);
        border-color: #a0aec0;
        outline: none;
      }
      #json-editor-container pre {
        margin: 0;
        white-space: pre-wrap;
        word-break: break-all;
      }
      #json-editor-container textarea {
        display: block;
        width: 100%;
        height: 100%;
        border: none;
        resize: none;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        font-size: 0.875rem;
        line-height: 1.5rem;
        background-color: transparent;
        color: #1f2937;
        padding: 0;
        outline: none;
      }
      #json-editor-container textarea:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(164, 202, 254, 0.5);
        border-radius: 0.375rem;
      }

      .error-message {
        color: #dc2626;
        font-size: 0.875rem;
        margin-top: 0.5rem;
      }
      .success-message {
        color: #16a34a;
        font-size: 0.875rem;
        margin-top: 0.5rem;
      }

      #json-output-container {
        background-color: #f7fafc;
        border: 2px solid #e5e7eb;
        border-radius: 0.5rem;
        padding: 1rem;
        margin-bottom: 1rem;
        display: flex;
        flex-direction: column;
        height: 100%;
        max-height: 500px;
        overflow-y: auto;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        font-size: 0.875rem;
        line-height: 1.5rem;
      }

      #json-output-container pre {
        margin: 0;
        white-space: pre-wrap;
        word-break: break-all;
        flex-grow: 1;
      }

      .collapsible {
        cursor: pointer;
      }

      .collapsible-content {
        display: none;
        margin-left: 1rem;
      }

      .collapsible-content.show {
        display: block;
      }

      .collapsible-arrow {
        display: inline-block;
        width: 0;
        height: 0;
        border-left: 5px solid transparent;
        border-right: 5px solid transparent;
        border-top: 10px solid #6b7280; /* Gray arrow color */
        margin-right: 0.5rem;
        transition: transform 0.2s ease-in-out;
      }

      .collapsible-arrow.collapsed {
        transform: rotate(0deg);
      }

      .collapsible-arrow.expanded {
        transform: rotate(90deg);
      }
    </style>
  </head>
  <body class="bg-gray-100 font-sans antialiased">
    <div class="container mx-auto p-4 md:p-6 lg:p-8">
      <h1 class="text-3xl font-semibold text-gray-800 mb-6 text-center">JSON Editor & Tools</h1>

      <div class="bg-white shadow-md rounded-lg p-4 md:p-6 space-y-4 mb-6">
        <h2 class="text-lg font-semibold text-gray-700">Actions</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
          <button id="validate-btn" class="bg-blue-500 hover:bg-blue-700 text-white font-semibold rounded-md py-2 px-4 focus:outline-none focus:shadow-outline">Validate</button>
          <button id="format-btn" class="bg-green-500 hover:bg-green-700 text-white font-semibold rounded-md py-2 px-4 focus:outline-none focus:shadow-outline">Format</button>
          <button id="copy-btn" class="bg-indigo-500 hover:bg-indigo-700 text-white font-semibold rounded-md py-2 px-4 focus:outline-none focus:shadow-outline">Copy</button>
          <button id="minify-btn" class="bg-yellow-500 hover:bg-yellow-700 text-gray-900 font-semibold rounded-md py-2 px-4 focus:outline-none focus:shadow-outline">Minify</button>
          <button id="download-btn" class="bg-purple-500 hover:bg-purple-700 text-white font-semibold rounded-md py-2 px-4 focus:outline-none focus:shadow-outline">Download</button>
          <button id="clear-btn" class="bg-red-500 hover:bg-red-700 text-white font-semibold rounded-md py-2 px-4 focus:outline-none focus:shadow-outline">Clear</button>
          <button id="import-btn" class="bg-gray-500 hover:bg-gray-700 text-white font-semibold rounded-md py-2 px-4 focus:outline-none focus:shadow-outline">Import File</button>
        </div>
        <input type="file" id="file-input" accept=".json" class="hidden">
      </div>

      <div class="flex flex-col md:flex-row gap-6" style="display: flex;">
        <div class="w-full md:w-1/2 space-y-6" style="flex: 1;">
          <div class="bg-white shadow-md rounded-lg p-4 md:p-6" style="height: 100%;">
            <h2 class="text-lg font-semibold text-gray-700 mb-4">JSON Input</h2>
            <div id="json-editor-container" tabindex="0" style="height: 100%;">
              <pre><textarea id="json-input" placeholder="Enter your JSON here..." style="height: 100%;"></textarea></pre>
            </div>
            <p id="input-error" class="error-message hidden"></p>
          </div>
        </div>

        <div class="w-full md:w-1/2 space-y-6" style="flex: 1;">
          <div class="bg-white shadow-md rounded-lg p-4 md:p-6" style="height: 100%;">
            <h2 class="text-lg font-semibold text-gray-700 mb-4">Output</h2>
            <div id="json-output-container" style="height: 100%;">
              <pre id="json-output" style="height: 100%;"></pre>
            </div>
            <p id="output-message" class="text-gray-600"></p>
          </div>
        </div>
      </div>
    </div>

    <script>
      const jsonInput = document.getElementById("json-input");
      const jsonOutput = document.getElementById("json-output");
      const validateBtn = document.getElementById("validate-btn");
      const formatBtn = document.getElementById("format-btn");
      const copyBtn = document.getElementById("copy-btn");
      const minifyBtn = document.getElementById("minify-btn");
      const downloadBtn = document.getElementById("download-btn");
      const clearBtn = document.getElementById("clear-btn");
      const importBtn = document.getElementById("import-btn");
      const fileInput = document.getElementById("file-input");
      const inputError = document.getElementById("input-error");
      const outputMessage = document.getElementById("output-message");

      function fixCommonJSONErrors(inputJSON) {
          inputJSON = inputJSON.replace(/([{,]\s*)([a-zA-Z0-9_-]+)\s*:/g, '$1"$2":');
          inputJSON = inputJSON.replace(/,(\s*[}\]])/g, '$1');
          inputJSON = inputJSON.replace(/:\s*"(.*?)"/g, (match, value) => {
              return `: "${value.trim()}"`;
          });
          return inputJSON;
      }

      function validateJSON() {
          try {
              const rawJSON = jsonInput.value.trim();
              if (!rawJSON) {
                  throw new Error("Empty input");
              }
              const fixedJSON = fixCommonJSONErrors(rawJSON);
              JSON.parse(fixedJSON);
              inputError.classList.add("hidden");
              outputMessage.textContent = "Valid JSON";
              outputMessage.style.color = "#16a34a";
              return fixedJSON;
          } catch (error) {
              inputError.textContent = "Invalid JSON: " + error.message;
              inputError.classList.remove("hidden");
              outputMessage.textContent = "";
              jsonOutput.textContent = "";
              return null;
          }
      }

      function formatJSON() {
          const validJSON = validateJSON();
          if (validJSON) {
            try {
                const parsedJSON = JSON.parse(validJSON);
                const formattedJSON = JSON.stringify(parsedJSON, null, 2);
                jsonOutput.innerHTML = ""; // Clear output
                const pre = document.createElement('pre');
                pre.style.height = '100%';
                // Use a function to recursively create collapsible elements
                const createCollapsible = (obj, level = 0) => {
                    if (typeof obj === 'object' && obj !== null) {
                        const container = document.createElement('div');
                        const isArray = Array.isArray(obj);
                        const typeName = isArray ? 'Array[' + obj.length + ']' : 'Object';

                        const collapsible = document.createElement('div');
                        collapsible.classList.add('collapsible');
                        collapsible.style.marginLeft = `${level * 16}px`; // Indentation

                        const arrow = document.createElement('span');
                        arrow.classList.add('collapsible-arrow', 'collapsed');
                        collapsible.appendChild(arrow);

                        const typeSpan = document.createElement('span');
                        typeSpan.textContent = isArray ? 'Array' : 'Object';
                        typeSpan.style.fontWeight = 'bold';
                        collapsible.appendChild(typeSpan);

                        const countSpan = document.createElement('span');
                        countSpan.textContent = ` (${isArray ? obj.length : Object.keys(obj).length})`;
                        countSpan.style.color = '#6b7280';
                        collapsible.appendChild(countSpan);

                        container.appendChild(collapsible);

                        const content = document.createElement('div');
                        content.classList.add('collapsible-content');
                        if(level === 0) {
                           content.classList.add('show');
                        }

                        for (const key in obj) {
                            if (obj.hasOwnProperty(key)) {
                                const value = obj[key];
                                const itemDiv = document.createElement('div');
                                itemDiv.style.marginLeft = `${level * 16 + 16}px`; // Indentation for items

                                if (typeof value === 'object' && value !== null) {
                                    const keySpan = document.createElement('span');
                                    keySpan.textContent = isArray ? `[${key}]: ` : `${key}: `;
                                    keySpan.style.fontWeight = 'bold';
                                    itemDiv.appendChild(keySpan);
                                    const nestedCollapsible = createCollapsible(value, level + 1);
                                    itemDiv.appendChild(nestedCollapsible);
                                } else {
                                    const keySpan = document.createElement('span');
                                    keySpan.textContent = isArray ? `[${key}]: ` : `${key}: `;
                                    keySpan.style.fontWeight = 'bold';
                                    itemDiv.appendChild(keySpan);
                                    const valueSpan = document.createElement('span');
                                    valueSpan.textContent = typeof value === 'string' ? `"${value}"` : value;
                                    valueSpan.style.color = typeof value === 'string' ? '#a71d5d' : '#008080';
                                    itemDiv.appendChild(valueSpan);
                                }
                                content.appendChild(itemDiv);
                            }
                        }
                        container.appendChild(content);

                        collapsible.addEventListener('click', () => {
                            content.classList.toggle('show');
                            arrow.classList.toggle('collapsed');
                            arrow.classList.toggle('expanded');
                        });
                        return container;
                    } else {
                        const valueSpan = document.createElement('span');
                        valueSpan.textContent = typeof obj === 'string' ? `"${obj}"` : obj;
                        valueSpan.style.color = typeof obj === 'string' ? '#a71d5d' : '#008080';
                        return valueSpan;
                    }
                };
                const collapsibleTree = createCollapsible(parsedJSON);
                pre.appendChild(collapsibleTree);
                jsonOutput.appendChild(pre);
                outputMessage.textContent = "JSON formatted";
                outputMessage.style.color = "#16a34a";
            } catch (e) {
                inputError.textContent = "Error formatting JSON: " + e.message;
                inputError.classList.remove("hidden");
                outputMessage.textContent = "";
                jsonOutput.textContent = "";
            }
          }
      }

      function minifyJSON() {
          const validJSON = validateJSON();
          if (validJSON) {
              try {
                  const parsedJSON = JSON.parse(validJSON);
                  const minifiedJSON = JSON.stringify(parsedJSON);
                  jsonOutput.textContent = minifiedJSON;
                  outputMessage.textContent = "JSON minified";
                  outputMessage.style.color = "#16a34a";
              } catch (e) {
                  inputError.textContent = "Error minifying JSON: " + e.message;
                  inputError.classList.remove("hidden");
                  outputMessage.textContent = "";
                  jsonOutput.textContent = "";
              }
          }
      }

      function copyToClipboard() {
          const outputText = jsonOutput.textContent;
          if (outputText) {
              navigator.clipboard
                  .writeText(outputText)
                  .then(() => {
                      outputMessage.textContent = "JSON copied to clipboard";
                      outputMessage.style.color = "#16a34a";
                  })
                  .catch((err) => {
                      outputMessage.textContent = "Failed to copy: " + err.message;
                      outputMessage.style.color = "#dc2626";
                  });
          } else {
              outputMessage.textContent = "Nothing to copy";
              outputMessage.style.color = "#dc2626";
          }
      }

      function downloadJSON() {
          const outputText = jsonOutput.textContent;
          if (outputText) {
              const blob = new Blob([outputText], { type: "application/json" });
              const url = URL.createObjectURL(blob);
              const a = document.createElement("a");
              a.href = url;
              a.download = "data.json";
              document.body.appendChild(a);
              a.click();
              document.body.removeChild(a);
              URL.revokeObjectURL(url);
              outputMessage.textContent = "JSON downloaded";
              outputMessage.style.color = "#16a34a";
          } else {
              outputMessage.textContent = "Nothing to download";
              outputMessage.style.color = "#dc2626";
          }
      }

      function clearInput() {
          jsonInput.value = "";
          jsonOutput.textContent = "";
          outputMessage.textContent = "";
          inputError.classList.add("hidden");
      }

      importBtn.addEventListener("click", () => {
          fileInput.click();
      });

      fileInput.addEventListener("change", (event) => {
          const file = event.target.files[0];
          if (file) {
              const reader = new FileReader();
              reader.onload = (e) => {
                  try {
                      jsonInput.value = e.target.result;
                      outputMessage.textContent = `File "${file.name}" imported`;
                      outputMessage.style.color = "#16a34a";
                  } catch (err) {
                      outputMessage.textContent = "Error processing file: " + err.message;
                      outputMessage.style.color = "#dc2626";
                  }
              };
              reader.onerror = () => {
                  const errorMessage = "Error reading file";
                  outputMessage.textContent = errorMessage;
                  outputMessage.style.color = "#dc2626";
                  console.error(errorMessage, reader.error);
              };
              reader.readAsText(file);
          } else {
              outputMessage.textContent = "No file selected";
              outputMessage.style.color = "#dc2626";
          }
      });

      validateBtn.addEventListener("click", validateJSON);
      formatBtn.addEventListener("click", formatJSON);
      copyBtn.addEventListener("click", copyToClipboard);
      minifyBtn.addEventListener("click", minifyJSON);
      downloadBtn.addEventListener("click", downloadJSON);
      clearBtn.addEventListener("click", clearInput);
    </script>
  </body>
</html>
